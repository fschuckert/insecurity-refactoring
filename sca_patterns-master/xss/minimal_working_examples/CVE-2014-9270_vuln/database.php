<?php

class Database
{
    private $pdo;

    function __construct()
    {
        $this->pdo = new PDO('sqlite:test.sql', null, null, array(PDO::ATTR_PERSISTENT => true));
        $this->pdo->query("CREATE TABLE test (id int, val varchar(255));");
    }

    function insert($id, $value)
    {
        $stmt = $this->pdo->prepare("INSERT INTO test VALUES (:id, :val)");
        $stmt->execute(array(':id' => $id, ':val' => $value));
    }

    function getValue($id)
    {
        $entries = array();

        $stmt = $this->pdo->prepare("SELECT val FROM test WHERE id=:id");
        if($stmt->execute(array(':id' => $id))){
            while( $row = $stmt->fetch()){
                $entries[] = $row['val'];
            }
        }

        $prefix = $this->gpc_get_string_simple('platform');

        $retval = $this->projax_array_filter_by_prefix($entries, $prefix);

        return $retval;
    }

    function gpc_get_string_simple($var_name)
    {
        if ( isset($_GET[$var_name]) )
        {
            $t_result = $_GET[$var_name];
        }
        else 
        {
            $t_result = null;
        }
        
        return str_replace( "\0","",$t_result );
    }

    function projax_array_filter_by_prefix($p_array, $p_prefix)
    {
        $t_matches = array();

        foreach( $p_array as $t_entry ) {
            if( strtolower( substr( $t_entry, 0, strlen( $p_prefix ) ) ) == strtolower( $p_prefix ) ) {
                $t_matches[] = $t_entry;
            }
        }

        return $t_matches;
    }
}

?>